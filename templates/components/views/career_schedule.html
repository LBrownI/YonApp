<!DOCTYPE html>
<section id="tab-career-schedule" class="view-section hidden space-y-6 h-full flex flex-col">
    <div class="flex justify-between items-center bg-white p-4 rounded-xl shadow-sm border border-slate-100">
        <div>
            <h2 class="text-xl font-bold text-slate-800">Planificador Académico</h2>
            <p class="text-sm text-slate-500">Visualización de horarios y bloqueos por semestre.</p>
        </div>
        
        <div class="flex gap-2">
            <button onclick="switchTab('career-list')" class="text-slate-400 hover:text-slate-600 p-2 rounded-lg transition" title="Volver al listado">
                <i data-lucide="list" class="w-5 h-5"></i>
            </button>

            <button id="btn-add-block-trigger" onclick="openAddBlockModal()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition shadow-sm flex items-center gap-2">
                <i data-lucide="plus-square" class="w-4 h-4"></i> Añadir Asignatura
            </button>
        </div>
    </div>

    <div class="flex gap-6 flex-1 overflow-hidden">
        <div class="w-64 bg-white p-4 rounded-xl shadow-sm border border-slate-100 flex flex-col gap-4 overflow-y-auto">
            <div>
                <label class="block text-xs font-bold text-slate-400 uppercase mb-1">Carrera Seleccionada</label>
                <div class="relative">
                    <input type="text" id="schedule-career-search" placeholder="Buscar carrera..." 
                           class="w-full p-2 border border-slate-200 rounded-lg text-sm font-bold text-purple-700 outline-none bg-purple-50 border-purple-200 focus:ring-2 focus:ring-purple-500"
                           oninput="filterCareerOptions()" onfocus="showCareerOptions()" onblur="hideCareerOptionsDelayed()">
                    <input type="hidden" id="schedule-career-selector">
                    
                    <div id="schedule-career-options" class="hidden absolute top-full left-0 w-full bg-white border border-slate-200 rounded-lg shadow-lg mt-1 max-h-60 overflow-y-auto z-50">
                        <!-- Options will be injected here -->
                    </div>
                </div>
            </div>
            <div>
                <label class="block text-xs font-bold text-slate-400 uppercase mb-1">Malla Curricular</label>
                <select id="schedule-malla-selector" onchange="handleScheduleSelectorChange()" class="w-full p-2 border border-slate-200 rounded-lg text-sm outline-none focus:border-purple-500 bg-slate-50"><option value="">-- Seleccionar --</option></select>
            </div>
            <div>
                <label class="block text-xs font-bold text-slate-400 uppercase mb-1">Semestre</label>
                <select id="schedule-sem-selector" onchange="handleScheduleSelectorChange()" class="w-full p-2 border border-slate-200 rounded-lg text-sm outline-none focus:border-purple-500 bg-slate-50"><option value="">-- Seleccionar --</option></select>
            </div>
            <div class="mt-auto pt-4 border-t border-slate-100">
                <div class="text-xs text-slate-400 uppercase font-bold mb-2">Leyenda</div>
                <div class="space-y-2 text-xs text-slate-600">
                    <div class="flex items-center gap-2"><div class="w-3 h-3 bg-blue-100 border border-blue-300 rounded"></div> TEO: Teórico </div>
                    <div class="flex items-center gap-2"><div class="w-3 h-3 bg-orange-100 border border-orange-300 rounded"></div> LAB: Laboratorio </div>
                    <div class="flex items-center gap-2"><div class="w-3 h-3 bg-green-100 border border-green-300 rounded"></div> TAL: Taller </div>
                    <div class="flex items-center gap-2"><div class="w-3 h-3 bg-purple-100 border border-purple-300 rounded"></div> SIM: Simulación </div>
                </div>
            </div>
        </div>

        <div class="flex-1 bg-white rounded-xl shadow-sm border border-slate-100 overflow-auto relative">
            <table class="w-full text-sm border-collapse min-w-[800px]">
                <thead class="bg-slate-50 text-slate-600 sticky top-0 z-10 shadow-sm">
                    <tr>
                        <th class="p-3 border-b border-slate-200 w-24 text-center font-semibold">Modulo</th>
                        <th class="p-3 border-b border-slate-200 w-1/6 text-left font-semibold">Lunes</th>
                        <th class="p-3 border-b border-slate-200 w-1/6 text-left font-semibold">Martes</th>
                        <th class="p-3 border-b border-slate-200 w-1/6 text-left font-semibold">Miércoles</th>
                        <th class="p-3 border-b border-slate-200 w-1/6 text-left font-semibold">Jueves</th>
                        <th class="p-3 border-b border-slate-200 w-1/6 text-left font-semibold">Viernes</th>
                        <th class="p-3 border-b border-slate-200 w-1/6 text-left font-semibold">Sábado</th>
                    </tr>
                </thead>
                <tbody id="schedule-grid-body">
                    </tbody>
            </table>
            <div id="schedule-empty-state" class="absolute inset-0 flex flex-col items-center justify-center bg-white z-0">
                <div class="bg-slate-50 p-6 rounded-full mb-4"><i data-lucide="calendar-clock" class="w-12 h-12 text-slate-300"></i></div>
                <p class="text-slate-400">Selecciona una malla y semestre.</p>
            </div>
        </div>
    </div>

    <div id="modal-add-block" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm">
        <div class="bg-white rounded-xl shadow-2xl w-[450px] p-6 animate-in fade-in zoom-in duration-200">
            <div class="flex justify-between items-center mb-6 border-b border-slate-100 pb-4">
                <h3 class="font-bold text-lg text-slate-800">Programar Bloque</h3>
                <button onclick="document.getElementById('modal-add-block').classList.add('hidden')" class="text-slate-400 hover:text-slate-600">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            
            <div class="space-y-5">
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1 uppercase">NRC</label>
                        <div class="relative">
                            <input type="text" id="block-nrc" placeholder="Buscar / escribir NRC" 
                                   class="w-full border border-slate-300 rounded-lg p-2 text-sm outline-none focus:ring-2 focus:ring-purple-500 font-mono"
                                   oninput="filterNrcOptions()" onfocus="showNrcOptions()" onblur="hideNrcOptionsDelayed()">
                            <div id="block-nrc-options" class="hidden absolute top-full left-0 w-full bg-white border border-slate-200 rounded-lg shadow-lg mt-1 max-h-48 overflow-y-auto z-50 text-xs">
                                <!-- NRC options injected from JS -->
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1 uppercase">Sección</label>
                        <input type="text" id="block-sec" placeholder="P50" class="w-full border border-slate-300 rounded-lg p-2 text-sm outline-none focus:ring-2 focus:ring-purple-500 font-mono">
                    </div>
                </div>

                <div>
                    <label class="block text-xs font-bold text-slate-500 mb-2 uppercase">Tipo</label>
                    <div class="grid grid-cols-4 gap-2" id="type-selector-container">
                        <input type="hidden" id="block-type" value="TEO">
                        
                        <button onclick="selectBlockType('TEO', this)" class="type-btn active border-2 border-blue-500 bg-blue-50 text-blue-700 font-bold py-2 rounded text-xs transition">TEO</button>
                        <button onclick="selectBlockType('LAB', this)" class="type-btn border border-slate-200 text-slate-500 hover:bg-slate-50 py-2 rounded text-xs transition">LAB</button>
                        <button onclick="selectBlockType('TAL', this)" class="type-btn border border-slate-200 text-slate-500 hover:bg-slate-50 py-2 rounded text-xs transition">TAL</button>
                        <button onclick="selectBlockType('SIM', this)" class="type-btn border border-slate-200 text-slate-500 hover:bg-slate-50 py-2 rounded text-xs transition">SIM</button>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1 uppercase">Día</label>
                        <select id="block-day" class="w-full border border-slate-300 rounded-lg p-2 text-sm outline-none focus:ring-2 focus:ring-purple-500 bg-white">
                            <option value="lunes">Lunes</option>
                            <option value="martes">Martes</option>
                            <option value="miercoles">Miércoles</option>
                            <option value="jueves">Jueves</option>
                            <option value="viernes">Viernes</option>
                            <option value="sabado">Sábado</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1 uppercase">Módulo</label>
                        <select id="block-mod" class="w-full border border-slate-300 rounded-lg p-2 text-sm outline-none focus:ring-2 focus:ring-purple-500 bg-white">
                            <option value="1">M1 (08:00 - 09:20)</option>
                            <option value="2">M2 (09:30 - 10:50)</option>
                            <option value="3">M3 (11:00 - 12:20)</option>
                            <option value="4">M4 (12:30 - 13:50)</option>
                            <option value="5">M5 (14:00 - 15:20)</option>
                            <option value="6">M6 (15:30 - 16:50)</option>
                            <option value="7">M7 (17:00 - 18:20)</option>
                            <option value="8">M8 (18:30 - 19:50)</option>
                        </select>
                    </div>
                </div>

                <button onclick="submitNewBlock()" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-2.5 rounded-lg transition shadow-md mt-4">
                    Añadir al Horario
                </button>
            </div>
        </div>
    </div>

    <div id="modal-edit-block" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm">
        <div class="bg-white rounded-xl shadow-2xl w-[450px] p-6 animate-in fade-in zoom-in duration-200">
            <div class="flex justify-between items-center mb-6 border-b border-slate-100 pb-4">
                <h3 class="font-bold text-lg text-slate-800">Editar Bloque</h3>
                <button onclick="document.getElementById('modal-edit-block').classList.add('hidden')" class="text-slate-400 hover:text-slate-600">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>

            <div class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1 uppercase">NRC</label>
                        <input type="text" id="edit-nrc" class="w-full border border-slate-300 rounded-lg p-2 text-sm outline-none focus:ring-2 focus:ring-purple-500 font-mono" disabled>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1 uppercase">Sección</label>
                        <input type="text" id="edit-sec" class="w-full border border-slate-300 rounded-lg p-2 text-sm outline-none focus:ring-2 focus:ring-purple-500 font-mono" disabled>
                    </div>
                </div>

                <div>
                    <label class="block text-xs font-bold text-slate-500 mb-2 uppercase">Tipo</label>
                    <div class="grid grid-cols-4 gap-2" id="edit-type-selector-container">
                        <input type="hidden" id="edit-block-type" value="">
                        
                        <button onclick="selectEditBlockType('TEO', this)" class="edit-type-btn border border-slate-200 text-slate-500 hover:bg-slate-50 py-2 rounded text-xs transition">TEO</button>
                        <button onclick="selectEditBlockType('LAB', this)" class="edit-type-btn border border-slate-200 text-slate-500 hover:bg-slate-50 py-2 rounded text-xs transition">LAB</button>
                        <button onclick="selectEditBlockType('TAL', this)" class="edit-type-btn border border-slate-200 text-slate-500 hover:bg-slate-50 py-2 rounded text-xs transition">TAL</button>
                        <button onclick="selectEditBlockType('SIM', this)" class="edit-type-btn border border-slate-200 text-slate-500 hover:bg-slate-50 py-2 rounded text-xs transition">SIM</button>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1 uppercase">Día</label>
                        <select id="edit-day" class="w-full border border-slate-300 rounded-lg p-2 text-sm outline-none focus:ring-2 focus:ring-purple-500 bg-white">
                            <option value="lunes">Lunes</option>
                            <option value="martes">Martes</option>
                            <option value="miercoles">Miércoles</option>
                            <option value="jueves">Jueves</option>
                            <option value="viernes">Viernes</option>
                            <option value="sabado">Sábado</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1 uppercase">Módulo</label>
                        <select id="edit-mod" class="w-full border border-slate-300 rounded-lg p-2 text-sm outline-none focus:ring-2 focus:ring-purple-500 bg-white">
                            <option value="1">M1 (08:00 - 09:20)</option>
                            <option value="2">M2 (09:30 - 10:50)</option>
                            <option value="3">M3 (11:00 - 12:20)</option>
                            <option value="4">M4 (12:30 - 13:50)</option>
                            <option value="5">M5 (14:00 - 15:20)</option>
                            <option value="6">M6 (15:30 - 16:50)</option>
                            <option value="7">M7 (17:00 - 18:20)</option>
                            <option value="8">M8 (18:30 - 19:50)</option>
                        </select>
                    </div>
                </div>

                <div class="flex gap-3 mt-4">
                    <button onclick="deleteBlockFromModal()" class="w-1/3 bg-red-600 hover:bg-red-700 text-white font-bold py-2.5 rounded-lg transition shadow-md">
                        Eliminar
                    </button>
                    <button onclick="saveEditedBlock()" class="flex-1 bg-purple-600 hover:bg-purple-700 text-white font-bold py-2.5 rounded-lg transition shadow-md">
                        Guardar Cambios
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-warning-missing-selection" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm">
        <div class="bg-white rounded-xl shadow-2xl w-[400px] p-6 animate-in fade-in zoom-in duration-200 border-l-4 border-yellow-500">
            <div class="flex justify-between items-start mb-4">
                <div class="flex items-center gap-3">
                    <div class="bg-yellow-100 p-2 rounded-full">
                        <i data-lucide="alert-triangle" class="w-6 h-6 text-yellow-600"></i>
                    </div>
                    <h3 class="font-bold text-lg text-slate-800">Atención</h3>
                </div>
                <button onclick="document.getElementById('modal-warning-missing-selection').classList.add('hidden')" class="text-slate-400 hover:text-slate-600">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            
            <p class="text-slate-600 text-sm mb-4">
                Para añadir una asignatura, es necesario configurar los siguientes campos:
            </p>
            
            <ul id="missing-selection-list" class="space-y-2 mb-6 text-sm font-medium text-red-600 list-disc list-inside bg-red-50 p-3 rounded-lg border border-red-100">
                <!-- List items will be injected here -->
            </ul>

            <button onclick="document.getElementById('modal-warning-missing-selection').classList.add('hidden')" class="w-full bg-slate-800 hover:bg-slate-900 text-white font-bold py-2.5 rounded-lg transition">
                Entendido
            </button>
        </div>
    </div>

    <div id="modal-confirm-delete-block" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm">
        <div class="bg-white rounded-xl shadow-2xl w-[400px] p-6 animate-in fade-in zoom-in duration-200 border-l-4 border-red-500">
            <div class="flex justify-between items-start mb-4">
                <div class="flex items-center gap-3">
                    <div class="bg-red-100 p-2 rounded-full">
                        <i data-lucide="trash-2" class="w-6 h-6 text-red-600"></i>
                    </div>
                    <h3 class="font-bold text-lg text-slate-800">Confirmar Eliminación</h3>
                </div>
                <button onclick="document.getElementById('modal-confirm-delete-block').classList.add('hidden')" class="text-slate-400 hover:text-slate-600">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            
            <p class="text-slate-600 text-sm mb-6">
                ¿Estás seguro de que deseas eliminar este bloque del horario? Esta acción no se puede deshacer.
            </p>
            
            <div class="flex gap-3">
                <button onclick="document.getElementById('modal-confirm-delete-block').classList.add('hidden')" class="w-1/2 bg-slate-100 hover:bg-slate-200 text-slate-600 font-bold py-2.5 rounded-lg transition">
                    Cancelar
                </button>
                <button onclick="confirmPlanningBlockDelete()" class="w-1/2 bg-red-600 hover:bg-red-700 text-white font-bold py-2.5 rounded-lg transition shadow-md">
                    Eliminar
                </button>
            </div>
        </div>
    </div>
</section>